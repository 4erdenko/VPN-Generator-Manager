# Задача:
Сделать API-интерфейс для твоего бота VPN-Generator.  
Хранить в БД информацию о запросе (по сути писать логи ответов ручки в БД).  
Написать тест на ручку для работы ручки с БД (в БД данные сохраняются, эти данные можно получить).

### Технологии:
* FastAPI
* Pytest
* Alembic
* SQLAlchemy
* Docker
* Docker-compose
* Postgres

### Ручки:
* Получить токен
* Получить юзеров
* Получить конкретного юзера
* Удалить юзера
* Получить статистику по юзеру
* Получить юзера по имени
* Получить конфиг-файл
* Ручка для получения действий за заданный период времени.

# Что сделано:
* Получить токен
* Получить юзеров
* Получить конкретного юзера
* Удалить юзера
* Получить статистику по юзеру
* Получить юзера по имени
* Получить конфиг-файл
* Ручка для получения действий за заданный период времени.

# Что не получилось:
* Написать тест на ручку для работы ручки с БД  
* Запустить всё в одной VPN сети головного контейнера с возможностью общения между собой

### Комментарий:
Пробовал разные подходы, потратил на это большую чатсь отведенного времени,  
но возникали проблемы с валидацией ответов тестовой базы, либо отказ работы с тестовой базой.

# Непредусмотренные проблемы:
* Все контейнеры должны работать в специальной сети VPN от Wireguard контейнера
* Специфическая работа докера с ipv6 таблицами
* Невозможность(?) установить порты в compose при работе через network_mode
* Невозможность(?) проверить работу контейнеров fastapi/db из-за работы внутри своей сети VPN,  
 возможное решение, установка NGINX, но требуется больше времени на отладку, тестирование,  
 возможно даже с NGINX не будет полноценно работать.
* Сложное тестирование без нужной техники, обязательно требуется Linux для работы с VPN контейнером

# Мысли:
* Возможно, единственно рабочей схемой было бы использование FastAPI части прямо в боте, вместо прямой работы бота с классом vpnworks, но практического смысла для такого усложнения нет.  
Также всё равно могут быть сетевые проблемы при общении FastAPI с Postgres.
* Логирование типов ответов было выбрано специально, потому что логирование самих ответов, противоречит требованиям анонимности VPN хостов.

# Итог:
Провел реструктуризацию, самого телеграм бота не трогал, просто адаптировал дериктории и изолировал проекты.

В целом, не получилось сделать тест. Остальное же упирается в узкое горлышко из Wireguard VPN (IPV6).  

Т.е если локально подключиться к нужной сети, запустить контейнер с базой и fastapi приложением (строго на Linux), то всё будет работать корректно.  

Я знаю, что можно сделать лучше и думаю что справился бы и с тестом, но из-за внезапного путешевствия в другой город, был частично лишен некоторых технических возможностей и части времени, но это мои проблемы, я понимаю.  

В нынешнем виде через `docker-compose.yml` все контейнеры запустятся, создадутся и выполнятся миграции, будет работать документация,  
но так как контейнеры не могут работать через VPN сеть и паралельно общаться друг с другом, тут либо менять базу, либо включать VPN полноценно на хосте и запускаться с Linux.

Ручное тестирование и отладку проводил в виртуальной машине на Linux образе.

Попробовал работать с типизацией и mypy, немного не хватило времени на более глубокое изучение этой системы.
